name: Update Submodules from Microservice Push
on:
  repository_dispatch:
    types: [submodule-updated]
jobs:
  update-submodules:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
      
      - name: Clone Eventy-back
        run: |
          git clone https://x-access-token:${{ secrets.PARENT_REPO_TOKEN }}@github.com/Mattheo4427/Eventy-back.git
          cd Eventy-back
          git checkout main
          git submodule sync
          git submodule update --init --remote
      
      - name: Commit submodule updates
        run: |
          cd Eventy-back
          git add eventy-users-service eventy-events-service eventy-tickets-service eventy-transactions-service eventy-interactions-service
          git diff-index --quiet HEAD || git commit -m "chore: update microservices submodules [skip ci]"
      
      - name: Push changes
        run: |
          cd Eventy-back
          git pull --rebase origin main
          git push origin main || echo "No changes to push"
      
      - name: Notify success
        run: echo "âœ… Microservices updated in Eventy-back!"